I am acting as the Product Architect. You are the Senior Lead Engineer.
We are deploying the "Advanced Intelligence Suite" v2.0 for the `Delivera` application.

**Strict Execution Protocol:**
1.  **Verbatim Implementation:** You must use the provided code snippets exactly. Do not simplify or summarize.
2.  **No Placeholders:** All text, formulas, and color codes are final.
3.  **Type Safety:** Ensure all new components use strict TypeScript interfaces.
4.  **Atomic Safety:** Do not break the existing Pinecone connection or Vercel AI SDK streams.

Please execute the following 4-Part Technical Specification sequentially.

---

### PART 1: SYSTEM PROMPT ENGINEERING (Backend Logic)
**Target:** The file defining the `system_prompt` (e.g., `app/api/chat/route.ts` or `lib/agent.ts`).
**Task:** Update the System Instructions. You must **APPEND** the following strict logic blocks to the `OPERATIONAL PROTOCOLS` section of the prompt.

*Copy this text exactly into the system prompt variable:*

```text
### ADVANCED INTELLIGENCE MODULES (STRICT EXECUTION)

#### MODULE 1: The "Courier Negotiation" Engine
**Trigger:** User asks to "negotiate," "lower rates," "compare prices," or complains about "high costs" of a specific partner.
**Execution Logic:**
1.  **Identify Target:** Extract the current partner name (e.g., "Delhivery").
2.  **Market Scan:** Search dataset for the *Best Alternative Partner* in the same `Region` and `Vehicle_Type`.
    * *Criteria:* Must have `Delivery_Rating` >= Current Partner AND `Delivery_Cost` < Current Partner.
3.  **Data Extraction:**
    * `Rating_Delta` = (Alternative Rating - Current Rating).
    * `Cost_Savings` = (Current Cost - Alternative Cost).
4.  **Generative Output:**
    * If no better partner exists: "Data suggests your current rate is actually competitive for this region."
    * If better partner exists: Draft a formal negotiation script:
        "SUBJECT: Rate Review based on Regional Performance Data.
        Dear [Name],
        Our data indicates that [Alternative Partner] is operating in the [Region] with a [Rating_Delta] point higher satisfaction rating, at a cost of ₹[Cost_Savings] less per shipment.
        I would prefer to keep my volume with you, but I need a rate match to ₹[Alternative_Price] to justify the premium."

#### MODULE 2: The "RTO Shield" (Predictive Risk Scoring)
**Trigger:** User proposes a specific shipment scenario (e.g., "Shipping Electronics to East via Truck").
**Execution Logic:**
1.  **Base Probability:** Start at 10%.
2.  **Risk Accumulation (Add to Base):**
    * +35% if `Weather` is Stormy/Rain/Fog (High Impact).
    * +25% if `Package_Type` is "Fragile" or "Perishable".
    * +20% if `Vehicle_Type` is "Truck" AND Distance < 500km (Inefficient).
    * +15% if Historical Data for this Route shows `delivery_status` = "Delayed".
3.  **Cap:** Max Score cannot exceed 99%.
4.  **Output Template:**
    * Start with: "**⚠️ RTO Risk Probability: [Score]%**"
    * Root Cause: "Primary Driver: [Identify the factor contributing the highest %]."
    * Mitigation: "Recommendation: Upgrade to [Safer Mode] to reduce risk by approx [X]%."

#### MODULE 3: The "Green Logistics" Calculator
**Trigger:** User mentions "Green," "Eco," "Carbon," or "Sustainability."
**Execution Logic:**
1.  **Comparative Math:** Compare CO2 of `Diesel Truck` (105g/km) vs `EV Van` (0g/km).
2.  **Calculation:** `Savings_KG = (Distance_KM * 0.105) / 1000`. Round to 2 decimals.
3.  **Conditional Tagging (CRITICAL):**
    * IF Savings > 0: You MUST append this hidden tag at the very end of your response: `[RENDER_GREEN_BADGE: SAVED_KG=2.45]` (Replace 2.45 with actual calc).
    * IF Savings = 0: Do not append tag.